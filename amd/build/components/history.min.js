define("block_ai_chat/components/history",["exports","block_ai_chat/components/base_content","core/str","core/templates","block_ai_chat/utils"],(function(_exports,_base_content,_str,_templates,_utils){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_base_content=_interopRequireDefault(_base_content),_templates=_interopRequireDefault(_templates);class History extends _base_content.default{static init(target){return new this({element:document.querySelector(target)})}create(){this.selectors={NEW_DIALOG_BUTTON:"[data-block_ai_chat-element='newdialogbutton']",CONVERSATIONLIST_ITEM:"[data-block_ai_chat-element='conversationlistitem']"}}stateReady(){this._hideContent()}_newDialogListener(){this.reactive.dispatch("createAndViewNewConversation")}async _renderContent(){let groupedByDate={};const conversationlist=await(0,_utils.callExternalFunction)("block_ai_chat_get_all_conversations",{contextid:this.reactive.state.static.contextid,component:this.reactive.state.static.component});if(null===conversationlist)return;const strToday=await(0,_str.getString)("today","core"),strYesterday=await(0,_str.getString)("yesterday","block_ai_chat");conversationlist.forEach((convo=>{const now=new Date,date=new Date(1e3*convo.timecreated),today=new Date(now.getFullYear(),now.getMonth(),now.getDate()),yesterday=new Date(now.getFullYear(),now.getMonth(),now.getDate()-1),twoWeeksAgo=new Date(now);twoWeeksAgo.setDate(now.getDate()-14);const options={weekday:"long",day:"2-digit",month:"2-digit"},monthOptions={month:"long",year:"2-digit"};let dateString="";dateString=date>=today?strToday:date>=yesterday?strYesterday:date>=twoWeeksAgo?date.toLocaleDateString(void 0,options):date.toLocaleDateString(void 0,monthOptions);const hours=date.getHours(),minutes=date.getMinutes().toString().padStart(2,"0");let convItem={title:convo.title,conversationid:convo.conversationid,time:hours+":"+minutes};groupedByDate[dateString]||(groupedByDate[dateString]=[]),groupedByDate[dateString].push(convItem)}));const templateData={dates:{groups:Object.keys(groupedByDate).map((key=>({key:key,objects:groupedByDate[key]})))}.groups},{html:html,js:js}=await _templates.default.renderForPromise("block_ai_chat/history_content",templateData);_templates.default.replaceNodeContents(this.getElement(),html,js),await this._setupafterContentRendering()}_setupafterContentRendering(){this.addEventListener(this.getElement(this.selectors.NEW_DIALOG_BUTTON),"click",this._newDialogListener),this.getElement().querySelectorAll(this.selectors.CONVERSATIONLIST_ITEM).forEach((conversationlistItem=>{this.addEventListener(conversationlistItem,"click",(()=>{const conversationid=conversationlistItem.dataset.block_ai_chatConversationid;this.reactive.dispatch("setConversationAndLoadChat",conversationid)}))}))}getViewName(){return"history"}}var _default=History;return _exports.default=_default,_exports.default}));

//# sourceMappingURL=history.min.js.map