define("block_ai_chat/components/personalist",["exports","block_ai_chat/components/base_content","core/str","block_ai_chat/constants","core/templates"],(function(_exports,_base_content,_str,_constants,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_base_content=_interopRequireDefault(_base_content),_templates=_interopRequireDefault(_templates);class PersonaList extends _base_content.default{static init(target){return new this({element:document.querySelector(target)})}create(){this.selectors={PERSONA_LIST_ITEM_SELECTED:'[data-block_ai_chat-element="personalistitem"].block_ai_chat-selected-personaitem',PERSONALIST_CONTENT:'[data-block_ai_chat-component="personalist-content"]',ADD_NEW_PERSONA_BUTTON:'[data-block_ai_chat-element="addnewpersonabutton"]',BACK_TO_CHAT_BUTTON:"[data-block_ai_chat-element='backtochatbutton']",SELECT_PERSONA_BUTTON:"[data-block_ai_chat-element='selectpersonabutton']"}}stateReady(){this._hideContent()}getWatchers(){return[...super.getWatchers(),{watch:"personas:created",handler:this._personaCreated},{watch:"personas:updated",handler:this._renderContent}]}async _renderContent(){const templateContext={generalpersonas:[{id:0,name:await(0,_str.getString)("nopersona","block_ai_chat"),nopersona:!0}],templatepersonas:[],userpersonas:[]},personas=Array.from(this.reactive.state.personas.values());personas.sort(((a,b)=>a.name.localeCompare(b.name))),personas.forEach((persona=>{const personaTemplateObject=this._exportPersonaForTemplate(persona);parseInt(persona.type)===_constants.PERSONA_TYPES.TYPE_TEMPLATE?templateContext.templatepersonas.push(personaTemplateObject):parseInt(persona.type)===_constants.PERSONA_TYPES.TYPE_USER&&templateContext.userpersonas.push(personaTemplateObject)}));const{html:html,js:js}=await _templates.default.renderForPromise("block_ai_chat/personalist_content",templateContext);_templates.default.replaceNodeContents(this.getElement(),html,js),await this._setupAfterContentRendering()}_handleSelectPersona(){this.reactive.dispatch("selectCurrentPersonaAndLoadChat",this.reactive.state.config.currentlyMarkedPersona)}_handleAddNewPersona(){this.reactive.dispatch("createNewDummyPersona")}async _personaCreated(_ref){let{element:element}=_ref,placeholder=document.createElement("div");placeholder.setAttribute("data-block_ai_chat-persona-id",element.id),this.getElement(this.selectors.PERSONALIST_CONTENT).appendChild(placeholder);const newelement=(await this.renderComponent(placeholder,"block_ai_chat/components/personalistitem",this._exportPersonaForTemplate(this.reactive.state.personas.get(element.id)))).getElement();this.getElement(this.selectors.PERSONALIST_CONTENT).replaceChild(newelement,placeholder)}_handleBackToChat(){this.reactive.dispatch("setView","chat")}_setupAfterContentRendering(){this.addEventListener(this.getElement(this.selectors.ADD_NEW_PERSONA_BUTTON),"click",this._handleAddNewPersona),this.addEventListener(this.getElement(this.selectors.BACK_TO_CHAT_BUTTON),"click",this._handleBackToChat),this.addEventListener(this.getElement(this.selectors.SELECT_PERSONA_BUTTON),"click",this._handleSelectPersona)}_exportPersonaForTemplate(persona){return{id:persona.id,name:persona.name,nopersona:!1,editable:this.reactive.state.static.isAdmin||this.reactive.state.static.canEditSystemPersonas&&parseInt(persona.type)===_constants.PERSONA_TYPES.TYPE_TEMPLATE||parseInt(persona.type)===_constants.PERSONA_TYPES.TYPE_USER&&parseInt(this.reactive.state.static.userid)===parseInt(persona.userid)}}getViewName(){return"personalist"}}var _default=PersonaList;return _exports.default=_default,_exports.default}));

//# sourceMappingURL=personalist.min.js.map