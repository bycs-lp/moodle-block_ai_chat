define("block_ai_chat/components/historymarker",["exports","theme_boost/bootstrap/popover","core/reactive"],(function(_exports,_popover,_reactive){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_popover=(obj=_popover)&&obj.__esModule?obj:{default:obj};class HistoryMarker extends _reactive.BaseComponent{static init(target){return new this({element:document.querySelector(target)})}create(){this.name="HistoryMarker",this.selectors={MESSAGES:"[data-block_ai_chat-element='messages']",MESSAGE:"[data-block_ai_chat-component='message']",HISTORY_MARKER_CONTENT:"[data-block_ai_chat-element='historymarkercontent']"}}async stateReady(){const historyMarkerContent=this.getElement(this.selectors.HISTORY_MARKER_CONTENT);historyMarkerContent&&new _popover.default(historyMarkerContent),this._updatePositionAndVisibility()}getWatchers(){return[{watch:"messages:created",handler:this._updatePositionAndVisibility},{watch:"messages:deleted",handler:this._updatePositionAndVisibility},{watch:"config.conversationContextLimit:updated",handler:this._updatePositionAndVisibility}]}_updatePositionAndVisibility(){const chatOutputContainer=this.getElement().parentElement,messages=this.reactive.state.messages,contextLimit=this.reactive.state.config.conversationContextLimit;if(messages.size<=contextLimit)return void this._hide();this.getElement(this.selectors.HISTORY_MARKER_CONTENT).textContent=contextLimit;const markerPosition=messages.size-2*contextLimit-1,messageId=Array.from(messages.values())[markerPosition].id;this.checkAndPositionMarker(chatOutputContainer,messageId)}checkAndPositionMarker(chatOutputContainer,messageId){let attempts=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const messageBeforeContext=chatOutputContainer.querySelector(this.selectors.MESSAGE+'[data-block_ai_chat-messageid="'.concat(messageId,'"]'));if(messageBeforeContext)return this._show(),void messageBeforeContext.after(this.getElement());attempts++,attempts<5&&setTimeout((()=>{this.checkAndPositionMarker(chatOutputContainer,messageId,attempts)}),500)}_hide(){this.getElement().classList.add("d-none")}_show(){this.getElement().classList.remove("d-none")}}var _default=HistoryMarker;return _exports.default=_default,_exports.default}));

//# sourceMappingURL=historymarker.min.js.map