{"version":3,"file":"agentresponse_controller.min.js","sources":["../src/agentresponse_controller.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module providing functions to extract information from the form.\n *\n * @module     block_ai_chat/agent_buttons\n * @copyright  2025 ISB Bayern\n * @author     Philipp Memmel\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as DomExtractor from 'block_ai_chat/dom_extractor';\n\nexport const init = () => {\n    document.querySelectorAll('[data-block_ai_chat-action=\"accept_suggestion\"]').forEach(button => {\n        button.addEventListener('click', () => {\n            button.disabled = true;\n            const declineButton = document.querySelector(\n                '[data-block_ai_chat-action=\"decline_suggestion\"][data-block_ai_chat-for-element=\"'\n                + button.dataset.block_ai_chatForElement + '\"]'\n            );\n            declineButton.disabled = true;\n            injectSuggestionIntoForm(button);\n        });\n    });\n\n    document.querySelectorAll('[data-block_ai_chat-action=\"decline_suggestion\"]').forEach(button => {\n        button.addEventListener('click', () => {\n            button.disabled = true;\n            const acceptButton = document.querySelector(\n                '[data-block_ai_chat-action=\"accept_suggestion\"][data-block_ai_chat-for-element=\"'\n                + button.dataset.block_ai_chatForElement + '\"]'\n            );\n            acceptButton.disabled = true;\n        });\n    });\n\n    document.querySelectorAll('[data-block_ai_chat-action=\"target_suggestion\"]').forEach(button => {\n        button.addEventListener('click', () => {\n            targetFieldInView(button);\n        });\n    });\n};\n\nconst injectSuggestionIntoForm = (button) => {\n    targetFieldInView(button, 'insert');\n    const htmlElement = document.getElementById(button.dataset.block_ai_chatForElement);\n\n    const formElements = DomExtractor.extractDomElements();\n    const relatedElement = formElements.filter(formElement => formElement.id === button.dataset.block_ai_chatForElement)[0];\n\n    if (relatedElement.type === 'textarea') {\n        htmlElement.value = button.dataset.block_ai_chatSuggestionvalue;\n        const tiny = window.tinymce.get(relatedElement.id);\n        if (tiny) {\n            tiny.setContent(button.dataset.block_ai_chatSuggestionvalue);\n        }\n    } else if (relatedElement.type === 'checkbox') {\n        if (parseInt(button.dataset.block_ai_chatSuggestionvalue) === 1) {\n            // We cannot set the value, because it won't fire events. So the mform YUI won't recognize a change.\n            if (!htmlElement.checked) {\n                htmlElement.click();\n            }\n        } else {\n            if (htmlElement.checked) {\n                htmlElement.click();\n            }\n        }\n    } else if (relatedElement.type === 'select') {\n        htmlElement.value = button.dataset.block_ai_chatSuggestionvalue;\n\n        // Trigger change event to ensure any dependent JavaScript is executed\n        const changeEvent = new Event('change', {bubbles: true});\n        htmlElement.dispatchEvent(changeEvent);\n    } else {\n        // For all other input types (text, email, number, etc.)\n        htmlElement.value = button.dataset.block_ai_chatSuggestionvalue;\n    }\n};\n\nconst targetFieldInView = (button, action) => {\n    const expandAllLink = document.querySelector('.mform .collapsible-actions .collapseexpand.collapsed');\n    if (expandAllLink) {\n        expandAllLink.click();\n    }\n\n    requestAnimationFrame(() => {\n        const htmlElement = document.getElementById(button.dataset.block_ai_chatForElement);\n\n        if (!htmlElement) {\n            return;\n        }\n\n        // Scroll element into view with smooth behavior and center it\n        htmlElement.scrollIntoView({\n            behavior: 'smooth',\n            block: 'center',\n            inline: 'nearest'\n        });\n\n        highlightElement(htmlElement, action);\n\n        // Focus the element if it's focusable\n        requestAnimationFrame(() => {\n            htmlElement.focus();\n        });\n    });\n};\n\nconst highlightElement = (element, action) => {\n    let parent = element.parentElement;\n    while (parent.tagName !== 'DIV' || !parent.classList.contains('fitem')) {\n        parent = parent.parentElement;\n    }\n\n    parent.classList.add('block_ai_chat-form_element_highlight');\n    if (action === 'insert') {\n        parent.classList.add('block_ai_chat-form_element_highlight-insert');\n    }\n    setTimeout(() => {\n        parent.classList.remove('block_ai_chat-form_element_highlight');\n        parent.classList.remove('block_ai_chat-form_element_highlight-insert');\n    }, 2000);\n};\n"],"names":["document","querySelectorAll","forEach","button","addEventListener","disabled","querySelector","dataset","block_ai_chatForElement","injectSuggestionIntoForm","targetFieldInView","htmlElement","getElementById","relatedElement","DomExtractor","extractDomElements","filter","formElement","id","type","value","block_ai_chatSuggestionvalue","tiny","window","tinymce","get","setContent","parseInt","checked","click","changeEvent","Event","bubbles","dispatchEvent","action","expandAllLink","requestAnimationFrame","scrollIntoView","behavior","block","inline","highlightElement","focus","element","parent","parentElement","tagName","classList","contains","add","setTimeout","remove"],"mappings":";;;;;;;;kCA0BoB,KAChBA,SAASC,iBAAiB,mDAAmDC,SAAQC,SACjFA,OAAOC,iBAAiB,SAAS,KAC7BD,OAAOE,UAAW,EACIL,SAASM,cAC3B,oFACEH,OAAOI,QAAQC,wBAA0B,MAEjCH,UAAW,EACzBI,yBAAyBN,cAIjCH,SAASC,iBAAiB,oDAAoDC,SAAQC,SAClFA,OAAOC,iBAAiB,SAAS,KAC7BD,OAAOE,UAAW,EACGL,SAASM,cAC1B,mFACEH,OAAOI,QAAQC,wBAA0B,MAElCH,UAAW,QAIhCL,SAASC,iBAAiB,mDAAmDC,SAAQC,SACjFA,OAAOC,iBAAiB,SAAS,KAC7BM,kBAAkBP,qBAKxBM,yBAA4BN,SAC9BO,kBAAkBP,OAAQ,gBACpBQ,YAAcX,SAASY,eAAeT,OAAOI,QAAQC,yBAGrDK,eADeC,aAAaC,qBACEC,QAAOC,aAAeA,YAAYC,KAAOf,OAAOI,QAAQC,0BAAyB,MAEzF,aAAxBK,eAAeM,KAAqB,CACpCR,YAAYS,MAAQjB,OAAOI,QAAQc,mCAC7BC,KAAOC,OAAOC,QAAQC,IAAIZ,eAAeK,IAC3CI,MACAA,KAAKI,WAAWvB,OAAOI,QAAQc,mCAEhC,GAA4B,aAAxBR,eAAeM,KACwC,IAA1DQ,SAASxB,OAAOI,QAAQc,8BAEnBV,YAAYiB,SACbjB,YAAYkB,QAGZlB,YAAYiB,SACZjB,YAAYkB,aAGjB,GAA4B,WAAxBhB,eAAeM,KAAmB,CACzCR,YAAYS,MAAQjB,OAAOI,QAAQc,mCAG7BS,YAAc,IAAIC,MAAM,SAAU,CAACC,SAAS,IAClDrB,YAAYsB,cAAcH,kBAG1BnB,YAAYS,MAAQjB,OAAOI,QAAQc,8BAIrCX,kBAAoB,CAACP,OAAQ+B,gBACzBC,cAAgBnC,SAASM,cAAc,yDACzC6B,eACAA,cAAcN,QAGlBO,uBAAsB,WACZzB,YAAcX,SAASY,eAAeT,OAAOI,QAAQC,yBAEtDG,cAKLA,YAAY0B,eAAe,CACvBC,SAAU,SACVC,MAAO,SACPC,OAAQ,YAGZC,iBAAiB9B,YAAauB,QAG9BE,uBAAsB,KAClBzB,YAAY+B,gBAKlBD,iBAAmB,CAACE,QAAST,cAC3BU,OAASD,QAAQE,mBACK,QAAnBD,OAAOE,UAAsBF,OAAOG,UAAUC,SAAS,UAC1DJ,OAASA,OAAOC,cAGpBD,OAAOG,UAAUE,IAAI,wCACN,WAAXf,QACAU,OAAOG,UAAUE,IAAI,+CAEzBC,YAAW,KACPN,OAAOG,UAAUI,OAAO,wCACxBP,OAAOG,UAAUI,OAAO,iDACzB"}