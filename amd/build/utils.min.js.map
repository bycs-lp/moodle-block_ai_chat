{"version":3,"file":"utils.min.js","sources":["../src/utils.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport {call as fetchMany} from 'core/ajax';\nimport Log from 'core/log';\nimport {add as addToast} from 'core/toast';\nimport {getString} from 'core/str';\nimport {exception as displayException} from 'core/notification';\n\n/**\n * Call external function and do error handling.\n *\n * @param {string} methodname the name of the external function to call\n * @param {string} args arguments for the external function\n * @returns {object|null} the content object or null in case of error\n */\nexport const callExternalFunction = async(methodname, args) => {\n    let result = null;\n    let error = null;\n    try {\n        result = await fetchMany([{\n            methodname: methodname,\n            args: args,\n        }])[0];\n    } catch (ex) {\n        error = ex;\n    }\n    if (error !== null) {\n        await displayException(error);\n        return null;\n    } else if (result && result.code !== 200) {\n        let errorMessage = await getString('errorwithcode', 'block_ai_chat', result.code);\n        if (result.message && result.message.length > 0) {\n            errorMessage += '<br/><br/>' + result.message;\n        }\n        await showErrorToast(errorMessage);\n        if (result.message && result.message.length > 0) {\n            Log.error('Error calling external function ' + methodname);\n            Log.error('Error message: ' + result.message);\n        }\n        if (result.debuginfo && result.debuginfo.length > 0) {\n            Log.error('Debuginfo: ' + result.debuginfo);\n        }\n        return null;\n    }\n    return result.content;\n};\n\nexport const callExternalFunctionReactiveUpdate = async(methodname, args) => {\n    let result = await callExternalFunction(methodname, args);\n    if (result !== null) {\n        result.map((updateMessage) => {\n            updateMessage.fields = JSON.parse(updateMessage.fields);\n            return updateMessage;\n        });\n    }\n    return result;\n};\n\nconst showErrorToast = async(message) => {\n    await addToast(message, {type: 'danger', autohide: false, closeButton: true});\n};\n\n/**\n * Hash function to get a hash of a string.\n *\n * @param {string} stringToHash the string to hash\n * @returns {Promise<string>} the promise containing a hex representation of the string encoded by SHA-256\n */\nexport const hash = async(stringToHash) => {\n    const encoder = new TextEncoder();\n    const data = encoder.encode(stringToHash);\n    const hashAsArrayBuffer = await window.crypto.subtle.digest(\"SHA-256\", data);\n    const uint8ViewOfHash = new Uint8Array(hashAsArrayBuffer);\n    return Array.from(uint8ViewOfHash)\n        .map((b) => b.toString(16).padStart(2, \"0\"))\n        .join(\"\");\n};\n"],"names":["callExternalFunction","async","methodname","args","result","error","ex","code","errorMessage","message","length","showErrorToast","debuginfo","content","map","updateMessage","fields","JSON","parse","type","autohide","closeButton","data","TextEncoder","encode","stringToHash","hashAsArrayBuffer","window","crypto","subtle","digest","uint8ViewOfHash","Uint8Array","Array","from","b","toString","padStart","join"],"mappings":"4XA4BaA,qBAAuBC,MAAMC,WAAYC,YAC9CC,OAAS,KACTC,MAAQ,SAERD,aAAe,cAAU,CAAC,CACtBF,WAAYA,WACZC,KAAMA,QACN,GACN,MAAOG,IACLD,MAAQC,MAEE,OAAVD,mBACM,2BAAiBA,OAChB,KACJ,GAAID,QAA0B,MAAhBA,OAAOG,KAAc,KAClCC,mBAAqB,kBAAU,gBAAiB,gBAAiBJ,OAAOG,aACxEH,OAAOK,SAAWL,OAAOK,QAAQC,OAAS,IAC1CF,cAAgB,aAAeJ,OAAOK,eAEpCE,eAAeH,cACjBJ,OAAOK,SAAWL,OAAOK,QAAQC,OAAS,iBACtCL,MAAM,mCAAqCH,yBAC3CG,MAAM,kBAAoBD,OAAOK,UAErCL,OAAOQ,WAAaR,OAAOQ,UAAUF,OAAS,gBAC1CL,MAAM,cAAgBD,OAAOQ,WAE9B,YAEJR,OAAOS,wGAGgCZ,MAAMC,WAAYC,YAC5DC,aAAeJ,qBAAqBE,WAAYC,aACrC,OAAXC,QACAA,OAAOU,KAAKC,gBACRA,cAAcC,OAASC,KAAKC,MAAMH,cAAcC,QACzCD,iBAGRX,cAGLO,eAAiBV,MAAAA,gBACb,cAASQ,QAAS,CAACU,KAAM,SAAUC,UAAU,EAAOC,aAAa,mBASvDpB,MAAAA,qBAEVqB,MADU,IAAIC,aACCC,OAAOC,cACtBC,wBAA0BC,OAAOC,OAAOC,OAAOC,OAAO,UAAWR,MACjES,gBAAkB,IAAIC,WAAWN,0BAChCO,MAAMC,KAAKH,iBACbjB,KAAKqB,GAAMA,EAAEC,SAAS,IAAIC,SAAS,EAAG,OACtCC,KAAK"}