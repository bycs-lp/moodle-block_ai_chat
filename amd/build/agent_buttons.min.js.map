{"version":3,"file":"agent_buttons.min.js","sources":["../src/agent_buttons.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module providing functions to extract information from the form.\n *\n * @module     block_ai_chat/agent_buttons\n * @copyright  2025 ISB Bayern\n * @author     Philipp Memmel\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as DomExtractor from 'block_ai_chat/dom_extractor';\n\nexport const init = () => {\n    document.querySelectorAll('[data-block_ai_chat-action=\"accept_suggestion\"]').forEach(button => {\n        console.log(button)\n        button.addEventListener('click', (e) => {\n            console.log(button.dataset);\n            button.disabled = true;\n            const declineButton = document.querySelector('[data-block_ai_chat-action=\"decline_suggestion\"][data-block_ai_chat-for-element=\"' + button.dataset.block_ai_chatForElement + '\"]');\n            declineButton.disabled = true;\n            injectSuggestionIntoForm(button);\n        })\n    });\n\n    document.querySelectorAll('[data-block_ai_chat-action=\"decline_suggestion\"]').forEach(button => {\n        console.log(button)\n        button.addEventListener('click', (e) => {\n            console.log(button.dataset);\n            button.disabled = true;\n            const acceptButton = document.querySelector('[data-block_ai_chat-action=\"accept_suggestion\"][data-block_ai_chat-for-element=\"' + button.dataset.block_ai_chatForElement + '\"]');\n            acceptButton.disabled = true;\n        })\n    });\n\n    document.querySelectorAll('[data-block_ai_chat-action=\"target_suggestion\"]').forEach(button => {\n        console.log(button)\n        button.addEventListener('click', (e) => {\n            console.log(button.dataset);\n            targetFieldInView(button);\n        })\n    });\n\n};\n\nconst injectSuggestionIntoForm = (button) => {\n    const htmlElement = document.getElementById(button.dataset.block_ai_chatForElement);\n    console.log(\"NOW INJECTING\")\n    console.log(\"VALUE TO INJECT\")\n    console.log(button.dataset.block_ai_chatSuggestionvalue)\n    console.log(htmlElement)\n\n    const formElements = DomExtractor.extractDomElements();\n    const relatedElement = formElements.filter(formElement => formElement.id === button.dataset.block_ai_chatForElement)[0];\n    console.log(relatedElement)\n\n    if (relatedElement.type === 'textarea') {\n        htmlElement.value = button.dataset.block_ai_chatSuggestionvalue;\n        const tiny = window.tinymce.get(relatedElement.id);\n        if (tiny) {\n            tiny.setContent(button.dataset.block_ai_chatSuggestionvalue);\n        }\n    } else if (relatedElement.type === 'checkbox') {\n        console.log('its a checkbox')\n        if (parseInt(button.dataset.block_ai_chatSuggestionvalue) === 1) {\n            console.log(\"setting the check\")\n            htmlElement.checked = true;\n        } else {\n            console.log(\"unchecking the checkbox\")\n            htmlElement.checked = false;\n        }\n    } else if (relatedElement.type === 'select') {\n        console.log('its a select')\n        htmlElement.value = button.dataset.block_ai_chatSuggestionvalue;\n\n        // Trigger change event to ensure any dependent JavaScript is executed\n        const changeEvent = new Event('change', { bubbles: true });\n        htmlElement.dispatchEvent(changeEvent);\n    } else {\n        // For all other input types (text, email, number, etc.)\n        htmlElement.value = button.dataset.block_ai_chatSuggestionvalue;\n    }\n\n    console.log(button.dataset.block_ai_chatSuggestionvalue)\n    console.log('html element after manipulation')\n    console.log(htmlElement);\n};\n\nconst targetFieldInView = (button) => {\n    const htmlElement = document.getElementById(button.dataset.block_ai_chatForElement);\n    console.log(\"TARGETING FIELD\");\n    console.log(htmlElement);\n\n    if (!htmlElement) {\n        console.warn('Target element not found:', button.dataset.block_ai_chatForElement);\n        return;\n    }\n\n    // Scroll element into view with smooth behavior and center it\n    htmlElement.scrollIntoView({\n        behavior: 'smooth',\n        block: 'center',\n        inline: 'nearest'\n    });\n\n    // Focus the element if it's focusable\n    if (htmlElement.focus && typeof htmlElement.focus === 'function') {\n        // Small delay to ensure scroll is complete\n        setTimeout(() => {\n            htmlElement.focus();\n        }, 500);\n    }\n};\n"],"names":["document","querySelectorAll","forEach","button","console","log","addEventListener","e","dataset","disabled","querySelector","block_ai_chatForElement","injectSuggestionIntoForm","targetFieldInView","htmlElement","getElementById","block_ai_chatSuggestionvalue","relatedElement","DomExtractor","extractDomElements","filter","formElement","id","type","value","tiny","window","tinymce","get","setContent","parseInt","checked","changeEvent","Event","bubbles","dispatchEvent","scrollIntoView","behavior","block","inline","focus","setTimeout","warn"],"mappings":";;;;;;;;kCA0BoB,KAChBA,SAASC,iBAAiB,mDAAmDC,SAAQC,SACjFC,QAAQC,IAAIF,QACZA,OAAOG,iBAAiB,SAAUC,IAC9BH,QAAQC,IAAIF,OAAOK,SACnBL,OAAOM,UAAW,EACIT,SAASU,cAAc,oFAAsFP,OAAOK,QAAQG,wBAA0B,MAC9JF,UAAW,EACzBG,yBAAyBT,cAIjCH,SAASC,iBAAiB,oDAAoDC,SAAQC,SAClFC,QAAQC,IAAIF,QACZA,OAAOG,iBAAiB,SAAUC,IAC9BH,QAAQC,IAAIF,OAAOK,SACnBL,OAAOM,UAAW,EACGT,SAASU,cAAc,mFAAqFP,OAAOK,QAAQG,wBAA0B,MAC7JF,UAAW,QAIhCT,SAASC,iBAAiB,mDAAmDC,SAAQC,SACjFC,QAAQC,IAAIF,QACZA,OAAOG,iBAAiB,SAAUC,IAC9BH,QAAQC,IAAIF,OAAOK,SACnBK,kBAAkBV,qBAMxBS,yBAA4BT,eACxBW,YAAcd,SAASe,eAAeZ,OAAOK,QAAQG,yBAC3DP,QAAQC,IAAI,iBACZD,QAAQC,IAAI,mBACZD,QAAQC,IAAIF,OAAOK,QAAQQ,8BAC3BZ,QAAQC,IAAIS,mBAGNG,eADeC,aAAaC,qBACEC,QAAOC,aAAeA,YAAYC,KAAOnB,OAAOK,QAAQG,0BAAyB,MACrHP,QAAQC,IAAIY,gBAEgB,aAAxBA,eAAeM,KAAqB,CACpCT,YAAYU,MAAQrB,OAAOK,QAAQQ,mCAC7BS,KAAOC,OAAOC,QAAQC,IAAIX,eAAeK,IAC3CG,MACAA,KAAKI,WAAW1B,OAAOK,QAAQQ,mCAEhC,GAA4B,aAAxBC,eAAeM,KACtBnB,QAAQC,IAAI,kBACkD,IAA1DyB,SAAS3B,OAAOK,QAAQQ,+BACxBZ,QAAQC,IAAI,qBACZS,YAAYiB,SAAU,IAEtB3B,QAAQC,IAAI,2BACZS,YAAYiB,SAAU,QAEvB,GAA4B,WAAxBd,eAAeM,KAAmB,CACzCnB,QAAQC,IAAI,gBACZS,YAAYU,MAAQrB,OAAOK,QAAQQ,mCAG7BgB,YAAc,IAAIC,MAAM,SAAU,CAAEC,SAAS,IACnDpB,YAAYqB,cAAcH,kBAG1BlB,YAAYU,MAAQrB,OAAOK,QAAQQ,6BAGvCZ,QAAQC,IAAIF,OAAOK,QAAQQ,8BAC3BZ,QAAQC,IAAI,mCACZD,QAAQC,IAAIS,cAGVD,kBAAqBV,eACjBW,YAAcd,SAASe,eAAeZ,OAAOK,QAAQG,yBAC3DP,QAAQC,IAAI,mBACZD,QAAQC,IAAIS,aAEPA,aAMLA,YAAYsB,eAAe,CACvBC,SAAU,SACVC,MAAO,SACPC,OAAQ,YAIRzB,YAAY0B,OAAsC,mBAAtB1B,YAAY0B,OAExCC,YAAW,KACP3B,YAAY0B,UACb,MAhBHpC,QAAQsC,KAAK,4BAA6BvC,OAAOK,QAAQG"}