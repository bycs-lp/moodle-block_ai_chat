{"version":3,"file":"dialog.min.js","sources":["../src/dialog.js"],"sourcesContent":["import DialogModal from 'block_ai_interface/dialog_modal';\n\nexport const init = async(params) => {\n    // Attach click listener to the ai button.\n    let button = document.getElementById(\"ai_interface_button\");\n    button.addEventListener('mousedown', function() {\n        buildModal(params);\n    });\n};\n\n/**\n * Build modal for ai_interface.\n * @param {*} params\n */\nasync function buildModal(params) {\n\n    const history = get_history();\n    const modal = await DialogModal.create({\n        templateContext: {\n            title: params.title,\n            history: history,\n        }\n    });\n\n    // Add class for styling when modal is displayed.\n    modal.getRoot().on('modal:shown', function(e) {\n        e.target.classList.add(\"ai_interface_modal\");\n        e.target.scrollTo(0, e.target.scrollHeight);\n    });\n    // Show modal.\n    modal.show();\n    // Wait for the modal to show and set focus.\n    setTimeout(function() {\n        focustextarea();\n    }, 300);\n}\n\n/**\n * Send input to ai connector.\n * @param {*} params\n */\nfunction send_input(params) {\n\n}\n\n/**\n * Get history from local cache.\n */\nfunction get_history() {\n    // Mock response.\n    return [\n        {\"senderself\": \"1\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n        {\"senderself\": \"\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n        {\"senderself\": \"1\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy.\"},\n        {\"senderself\": \"\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n        {\"senderself\": \"1\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n        {\"senderself\": \"\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n        {\"senderself\": \"1\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n        {\"senderself\": \"\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n        {\"senderself\": \"1\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy.\"},\n        {\"senderself\": \"\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n        {\"senderself\": \"1\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n        {\"senderself\": \"\", \"content\": \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n    ];\n}\n\n/**\n * Save conversation to local cache.\n */\nfunction cache_history(params) {\n\n}\n\n/**\n * Focus textarea, also wait till element is visible.\n */\nfunction focustextarea() {\n    let elapsed = 0;\n    const interval = 25;\n    const timeout = 2000;\n\n    const checkInterval = setInterval(() => {\n        // Check if the textarea exists.\n        const textarea = document.getElementById('block_ai_interface-input-id');\n        // textarea is a bad check, test with transition to be completed.\n        if (textarea) {\n            clearInterval(checkInterval);\n            // To set focus multiple times, focus has to be reset.\n            const rand = document.getElementsByTagName('input');\n            rand[0].focus();\n            textarea.focus();\n        }\n\n        // Increment elapsed time.\n        elapsed += interval;\n\n        // Check if the timeout has been reached.\n        if (elapsed >= timeout) {\n            clearInterval(checkInterval);\n        }\n    }, interval);\n}\n"],"names":["async","document","getElementById","addEventListener","params","history","modal","DialogModal","create","templateContext","title","getRoot","on","e","target","classList","add","scrollTo","scrollHeight","show","setTimeout","elapsed","interval","timeout","checkInterval","setInterval","textarea","clearInterval","getElementsByTagName","focus","focustextarea","buildModal"],"mappings":"0RAEoBA,MAAAA,SAEHC,SAASC,eAAe,uBAC9BC,iBAAiB,aAAa,2BASfC,cAEhBC,QAkCC,CACH,YAAe,YAAgB,+JAC/B,YAAe,WAAe,2TAC9B,YAAe,YAAgB,6EAC/B,YAAe,WAAe,+JAC9B,YAAe,YAAgB,+JAC/B,YAAe,WAAe,0TAC9B,YAAe,YAAgB,+JAC/B,YAAe,WAAe,2TAC9B,YAAe,YAAgB,6EAC/B,YAAe,WAAe,+JAC9B,YAAe,YAAgB,+JAC/B,YAAe,WAAe,2TA7C5BC,YAAcC,sBAAYC,OAAO,CACnCC,gBAAiB,CACbC,MAAON,OAAOM,MACdL,QAASA,WAKjBC,MAAMK,UAAUC,GAAG,eAAe,SAASC,GACvCA,EAAEC,OAAOC,UAAUC,IAAI,sBACvBH,EAAEC,OAAOG,SAAS,EAAGJ,EAAEC,OAAOI,iBAGlCZ,MAAMa,OAENC,YAAW,2BA6CPC,QAAU,QACRC,SAAW,GACXC,QAAU,IAEVC,cAAgBC,aAAY,WAExBC,SAAWzB,SAASC,eAAe,kCAErCwB,SAAU,CACVC,cAAcH,eAEDvB,SAAS2B,qBAAqB,SACtC,GAAGC,QACRH,SAASG,QAIbR,SAAWC,SAGPD,SAAWE,SACXI,cAAcH,iBAEnBF,UAnECQ,KACD,KA5BCC,CAAW3B"}